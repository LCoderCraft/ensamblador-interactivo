<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ensamblador Interactivo</title>
    <style>
        /* === DISEO AZUL Y BLANCO === */
        :root {
            --bg-color: #f0f4f8;          /* Fondo general muy claro */
            --panel-bg: #ffffff;          /* Fondo de paneles */
            --code-bg: #0f172a;           /* Azul muy oscuro para c贸digo */
            --code-text: #e2e8f0;         /* Texto c贸digo claro */
            --highlight: #3b82f6;         /* Azul brillante para selecci贸n */
            --accent: #1e40af;            /* Azul fuerte para t铆tulos */
            --border: #cbd5e1;            /* Bordes suaves */
            --context-bg: #eff6ff;        /* Fondo azul muy tenue para notas */
            --context-border: #bfdbfe;    /* Borde azul claro para notas */
        }

        body {
            font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: #334155;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        h1 {
            color: var(--accent);
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        p.subtitle {
            color: #64748b;
            font-size: 1.1em;
        }

        /* Contenedor Principal */
        .main-container {
            display: flex;
            width: 95%;
            max-width: 1400px;
            height: 750px;
            background-color: var(--panel-bg);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.1); /* Sombra azulada suave */
            overflow: hidden;
            border: 1px solid var(--border);
        }

        /* === PANEL IZQUIERDO: CDIGO === */
        .code-panel {
            flex: 4;
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 20px 0;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 15px;
            line-height: 1.6;
            border-right: 1px solid #334155;
        }

        .code-row {
            display: flex;
            padding: 4px 15px;
            cursor: pointer; /* Cambiado a pointer para indicar interactividad */
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .code-row:hover {
            background-color: #1e293b; /* Azul un poco m谩s claro */
            border-left-color: var(--highlight);
            color: #ffffff;
        }

        .line-num {
            color: #475569;
            text-align: right;
            min-width: 30px;
            margin-right: 20px;
            user-select: none;
            font-size: 0.9em;
        }

        .line-content {
            white-space: pre;
            flex-grow: 1;
        }

        .comment-style { color: #94a3b8; font-style: italic; }
        .label-style { color: #fbbf24; font-weight: bold; } /* Amarillo/Dorado */
        .directive-style { color: #c084fc; } /* Lila */
        .instruction-style { color: #60a5fa; font-weight: bold; } /* Azul claro */

        /* === PANEL DERECHO: EXPLICACIN === */
        .explanation-panel {
            flex: 6;
            padding: 40px;
            background-color: var(--panel-bg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .sticky-header {
            border-bottom: 2px solid var(--bg-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        #exp-type {
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 1px;
            color: #64748b;
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        #exp-title {
            color: var(--accent);
            margin: 0;
            font-size: 2em;
            line-height: 1.2;
        }

        #exp-content {
            font-size: 1.15em;
            line-height: 1.8;
            color: #334155;
            margin-bottom: 30px;
        }

        /* CAJA DE CONTEXTO / IMPORTANCIA */
        .context-box {
            background-color: var(--context-bg);
            border: 1px solid var(--context-border);
            border-left: 5px solid var(--highlight);
            padding: 20px;
            border-radius: 8px;
            margin-top: auto; /* Empuja hacia abajo si hay espacio */
            display: none; /* Oculto por defecto */
            animation: fadeIn 0.3s ease-in-out;
        }

        .context-box h3 {
            margin-top: 0;
            color: var(--accent);
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-icon { font-size: 1.2em; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Placeholder inicial */
        .placeholder-container {
            text-align: center;
            margin-top: 100px;
            color: #94a3b8;
        }
        .placeholder-icon {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
            opacity: 0.5;
        }

    </style>
</head>
<body>

    <header>
        <h1>Estructura de un Programa en Ensamblador</h1>
        <p class="subtitle">An谩lisis Interactivo: Funcionalidad y Dependencias</p>
    </header>

    <div class="main-container">
        <div class="code-panel" id="codePanel"></div>

        <div class="explanation-panel">
            <div id="dynamic-content" style="display:none;">
                <div class="sticky-header">
                    <span id="exp-type">Tipo de elemento</span>
                    <h2 id="exp-title">T铆tulo del Elemento</h2>
                </div>
                
                <div id="exp-content">
                    </div>

                <div id="context-box" class="context-box">
                    <h3><span class="context-icon"></span> Importancia / Relaci贸n</h3>
                    <p id="context-text">Detalles de la relaci贸n...</p>
                </div>
            </div>

            <div id="placeholder" class="placeholder-container">
                <span class="placeholder-icon"></span>
                <h3>Explora el c贸digo</h3>
                <p>Pasa el rat贸n sobre cualquier l铆nea a la izquierda<br>para ver su funci贸n, importancia y con qu茅 otras l铆neas trabaja.</p>
            </div>
        </div>
    </div>

    <script>
        // ====================================================
        // DATOS DEL DOCUMENTO (Con campo 'context' agregado)
        // ====================================================
        const assemblyData = [
            { 
                code: ";****** CDIGO DE INICIO ******", 
                type: "Comentario",
                explanation: "Inicio de la secci贸n que contiene directivas para configurar el entorno del programa.",
                context: null 
            },
            { 
                code: "ideal", 
                type: "Directiva",
                explanation: "Le dice a Turbo Assembler que utilice el modo ideal, una notaci贸n dise帽ada para simplificar la sintaxis.",
                context: "Configuraci贸n inicial. Si se omite, se usa la notaci贸n est谩ndar (como la de MASM)." 
            },
            { 
                code: "dosseg", 
                type: "Directiva",
                explanation: "Instruye al ensamblador para ordenar los segmentos de la misma forma que los compiladores de alto nivel.",
                context: "Importante para compatibilidad y estandarizaci贸n del orden de segmentos en memoria." 
            },
            { 
                code: "model small", 
                type: "Directiva Fundamental",
                explanation: "Define el modelo de memoria 'peque帽o' (small). C贸digo < 64KB, Datos+Pila < 64KB.",
                context: "CRTICO: Define c贸mo se generan los apuntadores (cercanos). Debe usarse a menos que el programa sea muy grande." 
            },
            { 
                code: "stack 256", 
                type: "Directiva",
                explanation: "Reserva 256 bytes para la pila (stack), usada para guardar direcciones de retorno y datos temporales.",
                context: "Obligatorio si se usan subrutinas o interrupciones para evitar sobrescribir datos." 
            },
            { 
                code: ";****** DECLARACIN DE CONSTANTES ******", 
                type: "Comentario",
                explanation: "Secci贸n separada para facilitar la lectura y modificaci贸n de valores fijos.",
                context: null 
            },
            { 
                code: "cte equ 10", 
                type: "Declaraci贸n Constante",
                explanation: "Asigna el valor 10 al s铆mbolo 'cte'. No ocupa memoria en el segmento de datos; es un reemplazo de texto.",
                context: "Diferencia clave: Con 'equ' NO se puede redefinir el valor m谩s adelante. Con '=' s铆 se podr铆a." 
            },
            { 
                code: ";****** VARIABLES DEL PROGRAMA ******", 
                type: "Comentario",
                explanation: "Define el 谩rea de memoria para datos mutables.",
                context: null 
            },
            { 
                code: "dataseg", 
                type: "Directiva de Segmento",
                explanation: "Marca el inicio del segmento de datos. Las variables definidas a continuaci贸n se guardar谩n aqu铆.",
                context: "Trabaja en conjunto con 'codeseg'. Separa l贸gicamente los datos del c贸digo ejecutable." 
            },
            { 
                code: "codsal db 0", 
                type: "Variable Inicializada",
                explanation: "Variable de 1 byte (db) con valor inicial 0. Se usar谩 como c贸digo de retorno al sistema.",
                context: "Relaci贸n: Este valor ser谩 le铆do al final del programa por la instrucci贸n 'mov al, [codsal]'." 
            },
            { 
                code: "dato1 db ?", 
                type: "Variable No Inicializada",
                explanation: "Reserva 1 byte en memoria sin valor espec铆fico (?).",
                context: null 
            },
            { 
                code: "dato2 db ?", 
                type: "Variable No Inicializada",
                explanation: "Reserva 1 byte en memoria sin valor espec铆fico (?).",
                context: null 
            },
            { 
                code: "resul db ?", 
                type: "Variable No Inicializada",
                explanation: "Reserva 1 byte en memoria para guardar el resultado de la operaci贸n.",
                context: null 
            },
            { 
                code: ";****** CDIGO DEL PROGRAMA ******", 
                type: "Comentario",
                explanation: "Secci贸n l贸gica principal.",
                context: null 
            },
            { 
                code: "codeseg", 
                type: "Directiva de Segmento",
                explanation: "Marca el inicio del segmento de c贸digo donde residen las instrucciones ejecutables.",
                context: "Define el alcance que abarca el registro CS (Code Segment)." 
            },
            { 
                code: "inicio:", 
                type: "Etiqueta",
                explanation: "Punto de entrada. Marca la direcci贸n de memoria de la primera instrucci贸n ejecutable.",
                context: "VINCULACIN: Esta etiqueta DEBE coincidir con la directiva 'end inicio' al final del archivo." 
            },
            { 
                code: "mov ax, @data", 
                type: "Instrucci贸n",
                explanation: "Carga la direcci贸n del segmento de datos (@data) en el acumulador AX.",
                context: "PASO 1 DE 2: Necesario porque el hardware del 8086 proh铆be mover valores inmediatos directamente a registros de segmento." 
            },
            { 
                code: "mov ds, ax", 
                type: "Instrucci贸n Cr铆tica",
                explanation: "Mueve el valor de AX al registro de segmento de datos (DS).",
                context: "PASO 2 DE 2: Completa la inicializaci贸n. Sin esto, el programa no puede encontrar las variables (dato1, codsal, etc.)." 
            },
            { 
                code: "; resul = dato1 + dato2 + cte", 
                type: "Comentario",
                explanation: "Pseudoc贸digo que explica la l贸gica aritm茅tica siguiente.",
                context: null 
            },
            { 
                code: "mov al, [dato1]", 
                type: "Instrucci贸n",
                explanation: "Lee el valor de la variable 'dato1' desde la memoria y lo guarda en el registro AL.",
                context: "Usa corchetes [] para indicar 'contenido de la direcci贸n', no la direcci贸n misma." 
            },
            { 
                code: "add al, [dato2]", 
                type: "Instrucci贸n",
                explanation: "Suma el valor en memoria de 'dato2' al valor actual de AL.",
                context: null 
            },
            { 
                code: "add al, cte", 
                type: "Instrucci贸n",
                explanation: "Suma la constante literal '10' (definida como cte) al registro AL.",
                context: "Aqu铆 'cte' es reemplazado por el n煤mero 10 directamente por el ensamblador antes de compilar." 
            },
            { 
                code: "mov [resul], al", 
                type: "Instrucci贸n",
                explanation: "Guarda el resultado final (actualmente en AL) en la variable de memoria 'resul'.",
                context: null 
            },
            { 
                code: "salir:", 
                type: "Etiqueta",
                explanation: "Marca el inicio de la rutina de salida est谩ndar.",
                context: "Referencia visual para estructurar el c贸digo, no afecta la ejecuci贸n por s铆 misma." 
            },
            { 
                code: ";****** CDIGO DE TERMINACIN ******", 
                type: "Comentario",
                explanation: "Bloque est谩ndar para finalizar programas DOS.",
                context: null 
            },
            { 
                code: "mov ah, 04Ch", 
                type: "Instrucci贸n (Preparaci贸n)",
                explanation: "Carga la funci贸n 4Ch (Terminar proceso) en la parte alta del acumulador (AH).",
                context: "DEPENDENCIA: Esta instrucci贸n prepara lo que har谩 la interrupci贸n 'int 21h' unas l铆neas m谩s abajo." 
            },
            { 
                code: "mov al, [codsal]", 
                type: "Instrucci贸n",
                explanation: "Carga el c贸digo de retorno (0) en AL.",
                context: "Importante: El sistema operativo (DOS/Windows) puede leer este valor para saber si hubo errores (errorlevel)." 
            },
            { 
                code: "int 21h", 
                type: "Interrupci贸n",
                explanation: "Llama al sistema operativo (DOS). El procesador mira AH (04Ch) y ejecuta la orden de 'Terminar Programa'.",
                context: "CRTICO: Sin esta l铆nea, el programa podr铆a colgarse o seguir ejecutando basura de la memoria." 
            },
            { 
                code: "end inicio", 
                type: "Directiva de Fin",
                explanation: "Indica al ensamblador que no hay m谩s c贸digo fuente.",
                context: "VINCULACIN: La etiqueta 'inicio' le dice al sistema operativo d贸nde comenzar la ejecuci贸n al cargar el programa." 
            }
        ];

        // ====================================================
        // LGICA DE GENERACIN
        // ====================================================
        const codePanel = document.getElementById('codePanel');
        const dynamicContent = document.getElementById('dynamic-content');
        const placeholder = document.getElementById('placeholder');
        
        const expType = document.getElementById('exp-type');
        const expTitle = document.getElementById('exp-title');
        const expContent = document.getElementById('exp-content');
        const contextBox = document.getElementById('context-box');
        const contextText = document.getElementById('context-text');

        // Generar filas de c贸digo
        assemblyData.forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'code-row';
            
            const lineNum = document.createElement('span');
            lineNum.className = 'line-num';
            lineNum.textContent = index + 1;
            
            const lineContent = document.createElement('span');
            lineContent.className = 'line-content';
            lineContent.textContent = item.code;

            // Coloreado sint谩ctico b谩sico
            const trimmed = item.code.trim();
            if (trimmed.startsWith(';')) {
                lineContent.classList.add('comment-style');
            } else if (trimmed.endsWith(':')) {
                lineContent.classList.add('label-style');
            } else if (['mov', 'add', 'int'].some(i => trimmed.startsWith(i))) {
                lineContent.classList.add('instruction-style');
            } else if (['ideal', 'model', 'stack', 'dataseg', 'codeseg', 'end'].some(d => trimmed.startsWith(d))) {
                lineContent.classList.add('directive-style');
            }

            row.appendChild(lineNum);
            row.appendChild(lineContent);
            codePanel.appendChild(row);

            // Eventos Mouse
            row.addEventListener('mouseenter', () => mostrarInfo(index));
        });

        // Restaurar vista al salir del panel
        codePanel.addEventListener('mouseleave', () => {
            dynamicContent.style.display = 'none';
            placeholder.style.display = 'block';
        });

        function mostrarInfo(index) {
            const data = assemblyData[index];
            
            // Ocultar placeholder, mostrar contenido
            placeholder.style.display = 'none';
            dynamicContent.style.display = 'block';

            // Llenar datos b谩sicos
            expType.textContent = data.type;
            
            // Determinar t铆tulo (limpiar c贸digo)
            let title = data.code.trim();
            if (title.startsWith(';')) title = "Comentario";
            else if (title.includes(' ')) title = title.split(' ')[0].toUpperCase(); // Coge la primera palabra (MOV, ADD...)
            else title = title.replace(':', '').toUpperCase(); // Etiquetas

            expTitle.textContent = title === "Comentario" ? "Comentario" : `Elemento: ${title}`;
            expContent.innerHTML = data.explanation;

            // L贸gica de Contexto / Relaci贸n
            if (data.context) {
                contextBox.style.display = 'block';
                contextText.textContent = data.context;
                
                // Cambiar color del borde si es cr铆tico
                if (data.context.includes("CRTICO") || data.context.includes("VINCULACIN")) {
                    contextBox.style.borderLeftColor = "#ef4444"; // Rojo si es cr铆tico
                    contextBox.querySelector('h3').style.color = "#ef4444";
                } else {
                    contextBox.style.borderLeftColor = "#3b82f6"; // Azul normal
                    contextBox.querySelector('h3').style.color = "#1e40af";
                }
            } else {
                contextBox.style.display = 'none';
            }
        }
    </script>
</body>
</html>